let width,height,mContext,ruleta,puntero,spinButton,bars,bglight,limite,divisiones=6,circumference=340,premios=["3","3","1","1","2","2"],rotate=!1,enablePost=!0,velocidad=5,valocity_handler=!0;export class Game extends Phaser.Scene{constructor(){super("Game")}create(){mContext=this,spinButton.on("pointerdown",(function(t){spinButton.setScale(1.3),rotate?(mContext.detener(),setTimeout((()=>{spinButton.disableInteractive()}),100)):(mContext.rotarConstante(),spinButton.setTexture("detenerBtn"))})),spinButton.on("pointerup",(function(){})),spinButton.on("pointerout",(()=>{spinButton.setScale(1.2)}))}update(){rotate&&(ruleta.angle+=velocidad),bglight&&(bglight.angle+=.5)}setBars(t,e){let i,a=0,s=[];for(;a<t;)i=e.physics.add.sprite(0,0,"rectangle"),i.premio=premios[a],i.visible=!1,s.push(i),a++;return s}getPremio(){Phaser.Actions.RotateAroundDistance(bars,{x:width/2,y:height/2-50},ruleta.rotation,circumference),bars.forEach((t=>{this.physics.add.collider(t,puntero,(function(e=t){e.disableBody(!0,!0),setTimeout((()=>{enablePost&&(enablePost=!1,axios.post("/storePremio",{premio:e.premio}).then((function(t){let i=t.data;"success"===i.status?mContext.popUp(e.premio):255===i.status&&(alert(i.message),location.reload())})).catch((function(t){console.log(t)})))}),500)}))}))}rotar(){ruleta.rotation=0,velocidad=1,rotate=!rotate,limite=this.getRndInteger(15,30)}rotarConstante(){ruleta.rotation=0,rotate=!rotate,limite=1e3}detener(){rotate=!rotate,puntero.setAngle(0),this.getPremio()}getRndInteger(t,e){return Math.floor(Math.random()*(e-t))+t}init(){width=this.game.config.width,height=this.game.config.height;this.add.image(width/12,width/12,"logo").setScale(1.5),this.add.image(width/2,height/2+415,"base");ruleta=this.add.sprite(width/2,height/2-45,"ruleta");let t=this.add.sprite(width/2-3,height/2-50,"luces");puntero=this.physics.add.sprite(width/2,height/7-10,"puntero"),puntero.setSize(!0,100,140),spinButton=this.physics.add.sprite(width/2,height/2-45,"girarBtn").setScale(1.2).setInteractive(),bars=this.setBars(divisiones,this);const e=new Phaser.Geom.Circle(width/2,height/2-50,circumference);Phaser.Actions.PlaceOnCircle(bars,e,0),this.anims.create({key:"casino-lights",frames:this.anims.generateFrameNumbers("luces",{start:0,end:1}),frameRate:5,repeat:-1}),t.anims.play("casino-lights",!0)}popUp(t){mContext.add.image(width/2,height/2,"bg-pop").setScale(1),mContext.add.image(width/2,height/2,`bgp-${t}`).setScale(1),bglight=mContext.add.image(width/2,height/2,"bg-light").setScale(1),mContext.add.image(width/2+20,height/2-50,`p-${t}`).setScale(1),setTimeout((()=>{location.reload()}),8e3)}}
